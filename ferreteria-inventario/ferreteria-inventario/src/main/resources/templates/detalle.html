<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle del Artículo - Sistema de Inventario</title>
    <link rel="stylesheet" th:href="@{/estilos/detalle.css}">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Detalle del Artículo</h1>
        <p th:text="${articulo.nombre}">Nombre del Artículo</p>
    </div>

    <nav class="nav">
        <a th:href="@{/}">← Volver al listado</a>
        <a th:href="@{/editar/{id}(id=${articulo.id})}"> Editar</a>
    </nav>

    <div class="content">
        <!-- Alerta de stock bajo -->
        <div class="alert-box alert-warning" th:if="${articulo.tieneStockBajo()}">
            <strong> ALERTA DE STOCK BAJO</strong><br>
            El stock actual (<span th:text="${articulo.stockActual}"></span>) es menor al stock mínimo
            (<span th:text="${articulo.stockMinimo}"></span>). Se recomienda reabastecer.
        </div>

        <!-- Información básica -->
        <div class="detail-card">
            <h2>Información General</h2>

            <div class="detail-row">
                <div class="detail-label">Código:</div>
                <div class="detail-value"><strong th:text="${articulo.codigo}"></strong></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Nombre:</div>
                <div class="detail-value" th:text="${articulo.nombre}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Descripción:</div>
                <div class="detail-value" th:text="${articulo.descripcion != null ? articulo.descripcion : 'Sin descripción'}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Categoría:</div>
                <div class="detail-value" th:text="${articulo.categoria}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Proveedor:</div>
                <div class="detail-value" th:text="${articulo.proveedor != null ? articulo.proveedor : 'No especificado'}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Estado:</div>
                <div class="detail-value">
                    <span th:if="${articulo.activo}" class="badge badge-success">✓ Activo</span>
                    <span th:unless="${articulo.activo}" class="badge badge-danger">✗ Inactivo</span>
                </div>
            </div>
        </div>

        <!-- Información de precios -->
        <div class="detail-card">
            <h2>Información de Precios</h2>

            <div class="detail-row">
                <div class="detail-label">Precio de Compra:</div>
                <div class="detail-value">$<span th:text="${#numbers.formatDecimal(articulo.precioCompra, 1, 2)}"></span></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Precio de Venta:</div>
                <div class="detail-value">$<span th:text="${#numbers.formatDecimal(articulo.precioVenta, 1, 2)}"></span></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Margen de Ganancia:</div>
                <div class="detail-value">
                    <span th:text="${#numbers.formatDecimal(articulo.calcularMargenGanancia(), 1, 2)}"></span>%
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Ganancia por Unidad:</div>
                <div class="detail-value">$<span th:text="${#numbers.formatDecimal(articulo.precioVenta.subtract(articulo.precioCompra), 1, 2)}"></span></div>
            </div>
        </div>

        <!-- Información de stock -->
        <div class="detail-card">
            <h2>Información de Inventario</h2>

            <div class="detail-row">
                <div class="detail-label">Stock Actual:</div>
                <div class="detail-value">
                    <strong th:text="${articulo.stockActual}"></strong> unidades
                    <span th:if="${articulo.tieneStockBajo()}" class="badge badge-warning">⚠️ Bajo</span>
                    <span th:if="${!articulo.tieneStockBajo()}" class="badge badge-success">✓ OK</span>
                </div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Stock Mínimo:</div>
                <div class="detail-value"><span th:text="${articulo.stockMinimo}"></span> unidades</div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Valor del Inventario:</div>
                <div class="detail-value">$<span th:text="${#numbers.formatDecimal(articulo.calcularValorInventario(), 1, 2)}"></span></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Ganancia Potencial:</div>
                <div class="detail-value">$<span th:text="${#numbers.formatDecimal(articulo.precioVenta.subtract(articulo.precioCompra).multiply(T(java.math.BigDecimal).valueOf(articulo.stockActual)), 1, 2)}"></span></div>
            </div>
        </div>

        <!-- Estadísticas visuales -->
        <div class="stats-grid">
            <div class="stat-box">
                <h3>Stock Disponible</h3>
                <div class="value" th:text="${articulo.stockActual}">0</div>
            </div>

            <div class="stat-box">
                <h3>Margen %</h3>
                <div class="value" th:text="${#numbers.formatDecimal(articulo.calcularMargenGanancia(), 1, 1)} + '%'">0%</div>
            </div>

            <div class="stat-box">
                <h3>Valor Total</h3>
                <div class="value">$<span th:text="${#numbers.formatDecimal(articulo.calcularValorInventario(), 1, 0)}">0</span></div>
            </div>
        </div>

        <!-- Información de fechas -->
        <div class="detail-card">
            <h2>Información de Registro</h2>

            <div class="detail-row">
                <div class="detail-label">Fecha de Registro:</div>
                <div class="detail-value" th:text="${#temporals.format(articulo.fechaRegistro, 'dd/MM/yyyy HH:mm:ss')}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">Última Actualización:</div>
                <div class="detail-value" th:text="${#temporals.format(articulo.fechaActualizacion, 'dd/MM/yyyy HH:mm:ss')}"></div>
            </div>

            <div class="detail-row">
                <div class="detail-label">ID del Sistema:</div>
                <div class="detail-value" th:text="${articulo.id}"></div>
            </div>
        </div>

        <!-- Acciones -->
        <div class="actions">
            <a th:href="@{/editar/{id}(id=${articulo.id})}" class="btn btn-warning">✏️ Editar Artículo</a>
            <a th:href="@{/}" class="btn btn-primary">← Volver al Listado</a>
            <form th:action="@{/eliminar/{id}(id=${articulo.id})}" method="post" style="margin: 0;">
                <button type="submit" class="btn btn-danger"
                        onclick="return confirm('¿Está seguro de eliminar este artículo?')">
                    Eliminar
                </button>
            </form>
        </div>
    </div>
</div>
</body>
</html>